<div class="container">
  <h2>Gestión de Turnos</h2>

  <div class="filters">
    <input type="text" [(ngModel)]="clientNameFilter" placeholder="Buscar por cliente">
    <input type="date" [(ngModel)]="dateFilter">
    <button (click)="onSearch()">Buscar</button>
  </div>

  <button (click)="openFormPopup(null)">Agregar Turno</button>

  <table>
    <thead>
      <tr>
        <th (click)="onSort('clientName')">Cliente</th>
        <th (click)="onSort('appointmentDate')">Fecha</th>
        <th (click)="onSort('startTime')">Hora</th>
        <th>Descripción</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      @if (loading()) {
        <tr>
          <td colspan="5">Cargando turnos...</td>
        </tr>
      } @else if (appointments().length > 0) {
        @for (appointment of appointments(); track appointment.id) {
          <tr>
            <td>{{ appointment.clientName }}</td>
            <td>{{ appointment.appointmentDate }}</td>
            <td>{{ appointment.startTime }}</td>
            <td>{{ appointment.description }}</td>
            <td>
              <button (click)="openFormPopup(appointment)">Editar</button>
              <button (click)="onDeleteAppointment(appointment.id)">Eliminar</button>
            </td>
          </tr>
        }
      } @else {
        <tr>
          <td colspan="5">No se encontraron turnos.</td>
        </tr>
      }
    </tbody>
  </table>
</div>

@if (showPopup()) {
  <app-appointment-form
    [selectedAppointment]="selectedAppointment()"
    (formSubmitted)="onAppointmentSubmitted()"
    (formCanceled)="onAppointmentCanceled()"
  ></app-appointment-form>
}
